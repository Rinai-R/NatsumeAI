# 压测过程中遇到的问题

1. 高并发下单的时候，过期的尤其是预订单很容易堆积，需要定时任务定期清理这些预订单，还有一个解决办法是用 mysql 分库分表或者直接使用分布式数据库。

2. 实测高并发场景下，由于在 redis 获取 token 后使用分布式事务导致延迟过长，引起大量的 504 错误，导致网关层的上下文超时并取消，可能导致 redis 归还逻辑无法正常进行，从而 redis 令牌数量和 DB 库存差异过大，主要原因就是商品库存非常充足下的高并发下单问题，解决方案是加一个令牌桶限流，过滤一下大量请求，但是这样会造成服务几乎不可用，那么转而考虑如何优化 outbox，这里可以不用 dtm 来实现 outbox,producer 这里不需要插入订单逻辑，直接让消费者做。

3. 商品推荐的 Agent 非常满，瓶颈不在代码，而是 LLM 的 API 太慢了，这里没有办法，要做好水平扩展和限流，否则不用 Planner + ReAct 模式，就写个 rag 完事。

4. 待补充