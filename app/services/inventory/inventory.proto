syntax = "proto3";

package inventory;

option go_package = "./inventory";

message Items {
    int64 product_id = 1;
    int64 quantity = 2;
}

message InventoryReq {
    int64 order_id = 1;
    int64 preorder_id = 2;
    repeated Items items = 3;
}

message InventoryResp {
    int32 status_code = 1;
    string status_msg = 2;
}

message GetInventoryReq {
    repeated int64 product_ids = 1;
}

message GetInventoryItem {
    int64 product_id = 1;
    int64 inventory = 2;
    int64 sold_count = 3;
}

message GetInventoryResp{
    int32 status_code = 1;
    string status_msg = 2;
    repeated GetInventoryItem items = 3;
}


message UpdateInventoryReq {
    int64 user_id = 1;
    repeated Items items = 2;
    int64 merchant_id = 3;
}

message CreateInventoryReq {
    int64 product_id = 1;
    int64 inventory = 2;
    int64 merchant_id = 3;
}

message DeleteInventoryReq {
    int64 product_id = 1;
    int64 merchant_id = 2;
}

message TryGetTokenReq {
    int64 preorder_id = 1;
    repeated Items items = 2;
}

message ReturnTokenReq {
    int64 preorder_id = 1;
    repeated Items items = 2;
}


service InventoryService {
    // 获取库存
    rpc GetInventory (GetInventoryReq) returns (GetInventoryResp);
    // 更新库存，商家调用
    rpc UpdateInventory (UpdateInventoryReq) returns (InventoryResp);
    // 结账的时候，根据库存快速发放令牌
    rpc TryGetToken (TryGetTokenReq) returns (InventoryResp);   
    // 归还令牌
    rpc ReturnToken (ReturnTokenReq) returns (InventoryResp);
    // 预扣
    rpc DecreasePreInventory (InventoryReq) returns (InventoryResp);
    // 实际扣减
    rpc DecreaseInventory (InventoryReq) returns (InventoryResp);
    // 归还预扣
    rpc ReturnPreInventory (InventoryReq) returns (InventoryResp);
    // 归还库存
    rpc ReturnInventory (InventoryReq) returns (InventoryResp);
    // 为商品创建库存
    rpc CreateInventory (CreateInventoryReq) returns (InventoryResp);
    // 删除商品的时候同时调用这个
    rpc DeleteInventory (DeleteInventoryReq) returns (InventoryResp);
}
